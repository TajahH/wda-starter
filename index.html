<!DOCTYPE html>
<html lang="en">

<head>
  <title>Showing Movie Data from an API</title>
  <link rel="stylesheet" href="./css/style.css" />
  <script type="module" src="./js/scripts.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body>
  <main>
    <header>
      <h1>Movie Project</h1>
    </header>
    <div class="page-section">
      <div class="movie-container" x-cloak x-data="movieListComponent()" x-init="init()">
        <select class="year-filter" aria-label="select years to filter" x-model="filter_year" @change="loadMovies()">
          <option value="">All Years</option>
          <template x-for="y in years" :key="y">
            <option :value="y" x-text="y"></option>
          </template>
        </select>
        <select class="genre-filter" aria-label="select genres to filter" x-model.number="filter_genre">
          <option value="">All Genres</option>
          <template x-for="g in genres" :key="g.id">
            <option :value="g.id" x-text="g.name"></option>
          </template>
        </select>
        <div x-show="filter_year !== ''">
          Showing movies from <span x-text="filter_year"></span>
        </div>
        <div x-show="filter_genre">
          Genre: <span x-text="genres.find(gg => gg.id == filter_genre)?.name || ''"></span>
        </div>
        <form @submit.prevent="doSearch()" style="margin: 0 0 1rem 0;">
          <input type="search" placeholder="Search movies..." x-model="searchText"
            aria-label="Search movies by keyword">
          <button type="submit">Search</button>
          <button type="button" @click="clearSearch()">Clear</button>
          <div>
            <a :href="`watchlist.html`">Watchlist: <span x-text="watchlistCount"></span></a>
          </div>
        </form>
        <form @submit.prevent="applyRuntimeFilter()">
          <input type="number" inputmode="numeric" min="0" step="1" placeholder="min runtime"
            x-model.number="runtimeMin" aria-label="Filter by Runtime minimum (mins)">
          <input type="number" inputmode="numeric" min="0" step="1" placeholder="max runtime"
            x-model.number="runtimeMax" aria-label="Filter by Runtime maximum (mins)">
          <button type="submit">Submit</button>
          <button type="button" @click="clearRuntime();">Clear</button>
        </form>
        <h2>Click on the movie posters to read the synopsis!</h2>
        <select class="popularity-sort" aria-label="Sort movies by popularity" x-model="popularitySort">
          <option value="ascending">Popularity: Low-High</option>
          <option value="descending">Popularity: High-Low</option>
        </select>
        <ul>
          <template x-for="movie in sortedMovies" :key="movie.id">
            <li class="card-container">
              <a class="movie-title" x-text="movie.title"></a>
              <p>Year: <span x-text="movie ? (movie.release_date || '').slice(0,4) : ''"></span></p>
              <p>Popularity: <span x-text="Number(movie.popularity ?? 0).toFixed(1)"></span></p>
              <a class="movie-poster-link" :href="`movie.html?movie_id=${movie.id}`"
                aria-label="View details for this movie">
                <img :src="movie?.poster_path ? `https://image.tmdb.org/t/p/w342${movie.poster_path}` : ''"
                  :alt="movie ? (movie.title + ' poster') : ''" loading="lazy" />
              </a>
              <button @click="toggleWatchlist(movie)" :aria-pressed="isInWatchlist(movie) ? 'true' : 'false'"
                :class="isInWatchlist(movie) ? 'watchlist-btn watchlist-btn--clear' : 'watchlist-btn'"
                x-text="isInWatchlist(movie) ? 'Remove' : 'Add to watchlist'">
              </button>
            </li>
          </template>
        </ul>
      </div>
    </div>
  </main>
  <footer>Created by Tajah Hamilton</footer>
</body>


</html>