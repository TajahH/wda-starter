<!DOCTYPE html>
<html>

<head>
  <title>Showing Movie Data from an API</title>
  <link rel="stylesheet" href="./css/style.css" />
  <script type="module" src="./js/scripts.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body>
  <div class="page-section">
    <h1>Movie Project</h1>
    <div class="movie-container" x-cloak x-data="movieListComponent()" x-init="init()">
      <select x-model="filter_year">
        <option value="">All Years</option>
        <template x-for="y in years" :key="y">
          <option :value="y" x-text="y"></option>
        </template>
      </select>
      <select x-model.number="filter_genre">
          <option value="">All Genres</option>
          <template x-for="g in genres" :key="g.id">
            <option :value="g.id" x-text="g.name"></option>
          </template>
        </select>
      <div x-show="filter_year !== ''">
        Showing movies from <span x-text="filter_year"></span>
      </div>
      <div x-show="filter_genre">
        Genre: <span x-text="genres.find(gg => gg.id == filter_genre)?.name || ''"></span>
      </div>
      <form @submit.prevent="doSearch()" style="margin: 0 0 1rem 0;">
        <input type="search" placeholder="Search movies..." x-model="searchText" aria-label="Search movies by keyword">
        <button type="submit">Search</button>
        <button type="button" @click="clearSearch()">Clear</button>
        <div>
          <a :href="`watchlist.html`">Watchlist: <span x-text="watchlistCount"></span></a>
        </div>
      </form>
      <ul>
        <template x-for="movie in filteredMovies" :key="movie.id">
          <li class="card-container">
            <a class="movie-title" :href="`movie.html?movie_id=${movie.id}`" x-text="movie.title"></a>
            <p>Year: <span x-text="movie ? (movie.release_date || '').slice(0,4) : ''"></span></p>
            <a class="movie-poster-link" :href="`movie.html?movie_id=${movie.id}`"
              aria-label="View details for this movie">
              <img :src="movie?.poster_path ? `https://image.tmdb.org/t/p/w342${movie.poster_path}` : ''"
                :alt="movie ? (movie.title + ' poster') : ''" loading="lazy" />
            </a>
            <button class="watchlist-btn" :class="isInWatchlist(movie) ? 'watchlist-btn--clear' : ''" type="button"
              @click="toggleWatchlist(movie)" x-text="isInWatchlist(movie) ? 'Remove' : 'Add to watchlist'">
            </button>
          </li>
        </template>
      </ul>
    </div>
  </div>
</body>

</html>